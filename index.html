<html>

<head>
    <link href="css/bootstrap.min.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="css/nke-jquery-ui.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="css/nke-style.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="js/panzoom.js" type="text/javascript"></script>
    <script src="js/jquery.min.js" type="text/javascript"></script>
    <script src="js/xtk.js" type="text/javascript"></script>
    <script src="js/jquery-ui.min.js" type="text/javascript"></script>
    <script src="js/bootstrap.min.js" type="text/javascript"></script>
    <script src="js/rainbow.js" type="text/javascript"></script>
    <script src="js/sylvester.js" type="text/javascript"></script>
    <script src="js/amplify.min.js" type="text/javascript"></script>
    <script src="js/viewer.js" type="text/javascript"></script>
    <script src="js/app-brain.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.4.11/d3.min.js"></script>
    <script src="js/cloud.js"></script>

<script>

    // Adapted from https://bl.ocks.org/jyucsiro/767539a876836e920e38bc80d2031ba7

    var palette = ["#7597D0", "#B07EB6", "#CEBE6D", "#77B58A", "#CE7D69", 
                   "#7D74A3", "#AEC87C", "#BA7E39", "#CF7593", "#846B43", 
                   "#62B1B2", "#8C4058", "#D8AE54", "#5AA8A7", "#3A3C7C", 
                   "#FF7B5B", "#72662A", "#91E580", "#9AB4E2", "#E291DD",
                   "#8B75EA", "#E0BD84", "#D64F7C", "#8ACEAF", "#C6CE5A"];

    function pad(number) { return (number < 10 ? '0' : '') + number };

    var n_domains = 0; 

    function loadWordCloud(n_domains) {

        document.getElementById("chart").innerHTML = "";

        d3.csv("/data/k" + pad(n_domains) + "/words_k" + pad(n_domains) + ".csv", function(data) {

            // n_domains = data[data.length - 1]["CLUSTER"];

            if (n_domains > 0) {
                for (i = 0; i < n_domains; i++) {

                    var domain_words = [];

                    for (j = 0; j < data.length; j++) {
                        if (parseInt(data[j]["CLUSTER"]) == i + 1) {
                            var term = data[j]["TOKEN"].replace(/_/g, " ");
                            var count = parseFloat(data[j]["R"]) * 1000; 
                            for (k = 0; k < count; k++) {
                                domain_words.push(term);
                            }
                        }
                    }
                    drawWordCloud(domain_words, palette[i]);
                }
            }
        });

    }


    function drawWordCloud(words, color){

    var word_count = {};

    if (words.length == 1){
        word_count[words[0]] = 1;
      } else {
        words.forEach(function(word){
          var word = word.toLowerCase();
          if (word != "" && word.length>1){
            if (word_count[word]){
              word_count[word]++;
            } else {
              word_count[word] = 1;
            }
          }
        })
      }

    var svg_location = "#chart";
    var width = 198; 
    var height = 145; 

    var fill = d3.scale.category20();

    var word_entries = d3.entries(word_count);

    var xScale = d3.scale.linear()
       .domain([0, d3.max(word_entries, function(d) {
          return d.value;
        })
       ])
       .range([1,18]);
    d3.layout.cloud().size([width, height])
      .timeInterval(20)
      .words(word_entries)
      .fontSize(function(d) { return xScale(+d.value); })
      .text(function(d) { return d.key; })
      .rotate(function() { return ~~(Math.random() * 2) * 90; })
      .font("Avenir")
      .on("end", draw)
      .start();

    function draw(words) {

      // Define the tooltip
      var tooltip = d3.select("body")
        .append("div")
        .style("position", "absolute")
        .style("z-index", "10")
        .style("visibility", "hidden")
        .style("font-size", "14px")
        .style("background", "white")
        .style("padding", "4px")
        .style("border-radius", "5px")
        .style("border-style", "solid")
        .style("border-color", "black")
        .style("border-width", "1px")
        .style("box-shadow", "2px 2px 3px #757575");

      // Draw the word cloud
      d3.select(svg_location).append("svg")
          .attr("width", width)
          .attr("height", height)
        .append("g")
          .attr("transform", "translate(" + [width >> 1, height >> 1] + ")")
        .selectAll("text")
          .data(words)
        .enter().append("text")
          .style("font-size", function(d) { return xScale(d.value) + "px"; })
          .style("font-family", "Avenir")
          .style("fill", color)
          .style("text-shadow", "2px 2px 3px #CECECE")
          .attr("text-anchor", "middle")
          .attr("transform", function(d) {
            return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
          })
          .text(function(d) { return d.key; })
          .on("mouseover", function(d, i) {
            d3.select(this).style("font-size", function(d) { return xScale(d.value) + 3 + "px"; });
            tooltip.html("<i>r<sub>pb</sub></i> = " + d.value / 1000)
                .style("left", d3.event.pageX + 10 + "px")
                .style("top", d3.event.pageY + 10 + "px");
            return tooltip.style("visibility", "visible")
          })
          .on("mouseout", function(d, i) {
            d3.select(this).style("font-size", function(d) { return xScale(d.value) + "px"; });
            return tooltip.style("visibility", "hidden")
          });
      }

      d3.layout.cloud().stop();
    }

</script>

</head>

<body>

<div>
    <center>
        <br/><br/>
        <img src="icon.png" height="50px" style="display:inline;margin-right:15px;margin-top:-25px;-webkit-filter: drop-shadow(2px 2px 3px gray); filter:drop-shadow(2px 2px 3px gray); " />
        <h1 style="font-family:Superclarendon;display:inline;text-shadow:2px 2px 3px gray">Neuroscience Knowledge Engine</h1>
        <br/><br/><br/><br/>
    </center>
</div>

<div>
    <div>
        <div id="button_container">
        <center>
            <p style="display:inline;">Number of Domains &nbsp;</p>
            <button onClick="loadBrainMap(2);loadWordCloud(2)">2</button>
            <button onClick="loadBrainMap(3);loadWordCloud(3)">3</button>
            <button onClick="loadBrainMap(4);loadWordCloud(4)">4</button>
            <button onClick="loadBrainMap(5);loadWordCloud(5)">5</button>
            <button onClick="loadBrainMap(6);loadWordCloud(6)">6</button>
            <button onClick="loadBrainMap(7);loadWordCloud(7)">7</button>
            <button onClick="loadBrainMap(8);loadWordCloud(8)">8</button>
            <button onClick="loadBrainMap(9);loadWordCloud(9)">9</button>
            <button onClick="loadBrainMap(10);loadWordCloud(10)">10</button>
            <button onClick="loadBrainMap(11);loadWordCloud(11)">11</button>
            <button onClick="loadBrainMap(12);loadWordCloud(12)">12</button>
            <button onClick="loadBrainMap(13);loadWordCloud(13)">13</button>
            <button onClick="loadBrainMap(14);loadWordCloud(14)">14</button>
            <button onClick="loadBrainMap(15);loadWordCloud(15)">15</button>
            <button onClick="loadBrainMap(16);loadWordCloud(16)">16</button>
            <button onClick="loadBrainMap(17);loadWordCloud(17)">17</button>
            <button onClick="loadBrainMap(18);loadWordCloud(18)">18</button>
            <button onClick="loadBrainMap(19);loadWordCloud(19)">19</button>
            <button onClick="loadBrainMap(20);loadWordCloud(20)">20</button>
            <button onClick="loadBrainMap(21);loadWordCloud(21)">21</button>
            <button onClick="loadBrainMap(22);loadWordCloud(22)">22</button>
            <button onClick="loadBrainMap(23);loadWordCloud(23)">23</button>
            <button onClick="loadBrainMap(24);loadWordCloud(24)">24</button>
            <button onClick="loadBrainMap(25);loadWordCloud(25)">25</button>
            <br/><br/>
        </center>
        </div>
    </div>
</div>

<div class='container'>
    <div class='view' id='view_coronal'>
        <canvas height='220' id='cor_canvas' width='220'></canvas>
        <div class='slider nav-slider-vertical' id='nav-yaxis' style="float:left"></div>
    </div>
    <div class='view' id='view_sagittal'>
        <canvas height='220' id='sag_canvas' width='264'></canvas>
        <div class='slider nav-slider-horizontal' id='nav-xaxis'></div>
    </div>
    <div class='view' id='view_axial'>
        <canvas height='220' id='axial_canvas' width='183'></canvas>
        <div class='slider nav-slider-vertical' id='nav-zaxis' style="float:right"></div>
    </div>
    <div id="layer_panel" align="center" >
        <div id="layer_list_panel" align="center">
            <p>Layers</p>
            <div id="layer_visible_list" align="center"></div>
            <ul id="layer_list" class="layer_settings" align="center">
            </ul>
        </div>
        <div id="layer_panel">
            <div id="layer_list_panel">
                <div id="layer_visible_list"></div>
                <ul id="layer_list" class="layer_settings">
                </ul>
            </div>
            <p>Opacity</p>
            <div id="layer_settings_panel" align="left">
                <select id="select_color" class="layer_settings" style="display:none"></select>
                <div class='slider layer_settings' id='opacity' align="center" style="width:195px"></div>
            </div>
        </div>
    </div>
</div>
<br/><br/><br/>

<div id="chart"></div>

</body>

</html>
